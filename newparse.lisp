(defun parse-json (tokens)
  (let ((token (first tokens)))
      (cond ((eq token '{)
                 (parse-object (cdr tokens)))
                           ((eq token '[)
                                      (parse-array (cdr tokens)))
                                                ((member token '(true false null))
                                                           token)
                                                                     ((stringp token)
                                                                                token)
                                                                                          ((numberp token)
                                                                                                     token)
                                                                                                               (t (error "Unexpected token: ~s" token)))))
                                                                                                               
                                                                                                               (defun parse-object (tokens)
                                                                                                                 (if (eq (first tokens) '})
                                                                                                                       (values (make-hash-table) tokens)
                                                                                                                           (let ((key (first tokens))
                                                                                                                                     (value (parse-json (cdr tokens)))
                                                                                                                                               (result (make-hash-table)))
                                                                                                                                                     (setf (gethash key result) value)
                                                                                                                                                           (multiple-value-bind (object rest) (parse-object (cdr tokens))
                                                                                                                                                                   (setf (hash-table-entries result) (nconc (hash-table-entries object) (hash-table-entries result)))
                                                                                                                                                                           (values result rest)))))
                                                                                                                                                                           
                                                                                                                                                                           (defun parse-array (tokens)
                                                                                                                                                                             (if (eq (first tokens) '])
                                                                                                                                                                                   (values '() tokens)
                                                                                                                                                                                       (let ((value (parse-json tokens))
                                                                                                                                                                                                 (result '()))
                                                                                                                                                                                                       (multiple-value-bind (array rest) (parse-array (cdr tokens))
                                                                                                                                                                                                               (setf result (cons value array))
                                                                                                                                                                                                                       (values result rest)))))
                                                                                                                                                                                                                       (defun parse-json (tokens)
                                                                                                                                                                                                                         (let ((token (first tokens)))
                                                                                                                                                                                                                             (cond ((eq token '{)
                                                                                                                                                                                                                                        (parse-object (cdr tokens)))
                                                                                                                                                                                                                                                  ((eq token '[)
                                                                                                                                                                                                                                                             (parse-array (cdr tokens)))
                                                                                                                                                                                                                                                                       ((member token '(true false null))
                                                                                                                                                                                                                                                                                  token)
                                                                                                                                                                                                                                                                                            ((stringp token)
                                                                                                                                                                                                                                                                                                       token)
                                                                                                                                                                                                                                                                                                                 ((numberp token)
                                                                                                                                                                                                                                                                                                                            token)
                                                                                                                                                                                                                                                                                                                                      (t (error "Unexpected token: ~s" token)))))
                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                      (defun parse-object (tokens)
                                                                                                                                                                                                                                                                                                                                        (if (eq (first tokens) '})
                                                                                                                                                                                                                                                                                                                                              (values (make-hash-table) tokens)
                                                                                                                                                                                                                                                                                                                                                  (let ((key (first tokens))
                                                                                                                                                                                                                                                                                                                                                            (value (parse-json (cdr tokens)))
                                                                                                                                                                                                                                                                                                                                                                      (result (make-hash-table)))
                                                                                                                                                                                                                                                                                                                                                                            (setf (gethash key result) value)
                                                                                                                                                                                                                                                                                                                                                                                  (multiple-value-bind (object rest) (parse-object (cdr tokens))
                                                                                                                                                                                                                                                                                                                                                                                          (setf (hash-table-entries result) (nconc (hash-table-entries object) (hash-table-entries result)))
                                                                                                                                                                                                                                                                                                                                                                                                  (values result rest)))))
                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                  (defun parse-array (tokens)
                                                                                                                                                                                                                                                                                                                                                                                                    (if (eq (first tokens) '])
                                                                                                                                                                                                                                                                                                                                                                                                          (values '() tokens)
                                                                                                                                                                                                                                                                                                                                                                                                              (let ((value (parse-json tokens))
                                                                                                                                                                                                                                                                                                                                                                                                                        (result '()))
                                                                                                                                                                                                                                                                                                                                                                                                                              (multiple-value-bind (array rest) (parse-array (cdr tokens))
                                                                                                                                                                                                                                                                                                                                                                                                                                      (setf result (cons value array))
                                                                                                                                                                                                                                                                                                                                                                                                                                              (values result rest)))))
                                                                                                                                                                                                                                                                                                                                                                                                                                              ]))})))))]))})))))